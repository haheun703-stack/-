<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>일일 업무일지 — 자비스</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Noto Sans KR', 'Apple SD Gothic Neo', sans-serif;
    background: #0a0f1a;
    color: #e0e6ed;
    padding: 20px;
    max-width: 820px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* ═══ 헤더 ═══ */
  .header {
    text-align: center;
    padding: 28px 20px;
    background: linear-gradient(135deg, #1a1000 0%, #2d1a0d 50%, #1a1000 100%);
    border-radius: 16px;
    border: 1px solid #ff9800;
    margin-bottom: 20px;
    position: relative;
    overflow: hidden;
  }
  .header::before {
    content: '';
    position: absolute;
    top: -50%; left: -50%;
    width: 200%; height: 200%;
    background: radial-gradient(circle at 30% 50%, rgba(255,152,0,0.08) 0%, transparent 50%);
    animation: pulse 4s ease-in-out infinite;
  }
  @keyframes pulse { 0%,100% { opacity: 0.5; } 50% { opacity: 1; } }
  .header h1 {
    font-size: 1.5em; font-weight: 900; position: relative;
    background: linear-gradient(90deg, #ff9800, #ff5252);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
  }
  .header .sub { color: #6b7b8d; font-size: 0.82em; margin-top: 6px; position: relative; }
  .header .date-tag {
    display: inline-block;
    background: rgba(255,152,0,0.15);
    color: #ffcc80;
    padding: 3px 12px;
    border-radius: 20px;
    font-size: 0.72em;
    margin-top: 8px;
    position: relative;
  }

  /* ═══ 섹션 타이틀 ═══ */
  .section-title {
    font-size: 1.05em;
    font-weight: 700;
    margin: 24px 0 14px;
    padding-left: 12px;
    border-left: 3px solid #ff9800;
  }

  /* ═══ 요약 바 ═══ */
  .summary-bar { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }
  .summary-card {
    flex: 1; min-width: 130px;
    background: #131a2b; border-radius: 10px; padding: 12px;
    text-align: center; border: 1px solid #1e2a3d;
  }
  .summary-card .label { font-size: 0.7em; color: #6b7b8d; text-transform: uppercase; }
  .summary-card .value { font-size: 1.3em; font-weight: 700; color: #ff9800; }
  .summary-card .value.green { color: #00e676; }
  .summary-card .value.red { color: #ff5252; }

  /* ═══ 테이블 ═══ */
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 0.78em; }
  th {
    background: #1a2235; color: #8899aa; font-weight: 600;
    padding: 8px 6px; text-align: center;
    border-bottom: 2px solid #ff9800;
  }
  td { padding: 8px 6px; text-align: center; border-bottom: 1px solid #1e2a3d; }
  tr:hover { background: rgba(255,152,0,0.05); }
  .green { color: #00e676; }
  .red { color: #ff5252; }
  .yellow { color: #ffea00; }
  .orange { color: #ff9800; }
  .blue { color: #448aff; }

  /* ═══ 카드 ═══ */
  .journal-card {
    background: #131a2b; border-radius: 12px; padding: 16px;
    margin-bottom: 16px; border: 1px solid #1e2a3d;
    transition: border-color 0.3s;
  }
  .journal-card:hover { border-color: #ff9800; }
  .journal-card h3 { font-size: 0.95em; margin-bottom: 8px; color: #ff9800; }
  .journal-card p { font-size: 0.82em; color: #b0bec5; }
  .journal-card ul { font-size: 0.82em; color: #b0bec5; padding-left: 20px; }
  .journal-card li { margin-bottom: 4px; }

  /* ═══ Phase 뱃지 ═══ */
  .phase-badge {
    display: inline-block; padding: 2px 10px; border-radius: 4px;
    font-size: 0.72em; font-weight: 600;
  }
  .phase-ok { background: rgba(0,230,118,0.12); color: #00e676; }
  .phase-skip { background: rgba(255,234,0,0.12); color: #ffea00; }
  .phase-fail { background: rgba(255,82,82,0.12); color: #ff5252; }

  /* ═══ 등급 뱃지 ═══ */
  .grade-badge {
    display: inline-block; padding: 2px 10px; border-radius: 6px;
    font-size: 0.75em; font-weight: 700;
  }
  .grade-A { background: rgba(0,230,118,0.15); color: #00e676; }
  .grade-B { background: rgba(255,234,0,0.15); color: #ffea00; }
  .grade-C { background: rgba(255,152,0,0.15); color: #ff9800; }

  /* ═══ 거래 방향 ═══ */
  .trade-row-buy { border-left: 3px solid #00e676; }
  .trade-row-sell { border-left: 3px solid #ff5252; }

  /* ═══ 시그널 카드 ═══ */
  .signal-card {
    background: #0d1420; border-radius: 10px; padding: 14px;
    margin-bottom: 12px; border: 1px solid #1e2a3d;
    display: flex; justify-content: space-between; align-items: center;
    flex-wrap: wrap; gap: 8px;
  }
  .signal-card:hover { border-color: #ff9800; }
  .signal-name { font-weight: 700; font-size: 0.9em; }
  .signal-code { color: #6b7b8d; font-size: 0.72em; }
  .signal-info { display: flex; gap: 10px; flex-wrap: wrap; }
  .signal-tag {
    padding: 3px 10px; border-radius: 6px;
    font-size: 0.72em; background: #1a2235; white-space: nowrap;
  }

  /* ═══ 교훈 카드 ═══ */
  .lesson-card {
    background: #0d1420; border-left: 3px solid #ff9800;
    padding: 12px 16px; border-radius: 0 8px 8px 0;
    font-size: 0.82em; margin-bottom: 8px;
  }
  .lesson-card strong { color: #ffcc80; }

  .disclaimer {
    text-align: center; font-size: 0.68em; color: #4a5568;
    margin-top: 24px; padding: 12px;
    border-top: 1px solid #1e2a3d;
  }

  @media (max-width: 600px) {
    body { padding: 12px; }
    .signal-card { flex-direction: column; align-items: flex-start; }
    .signal-info { gap: 4px; }
    .signal-tag { font-size: 0.65em; padding: 2px 6px; }
  }
</style>
</head>
<body>

<!-- ═══ 헤더 ═══ -->
<div class="header">
  <h1>JARVIS Daily Journal</h1>
  <p class="sub">일일 업무일지 &middot; {{ journal.day_type }}</p>
  <div class="date-tag">{{ journal.date }} &middot; KOSPI {{ journal.kospi_str }}</div>
</div>

<!-- ═══ 일일 요약 ═══ -->
<div class="summary-bar">
  <div class="summary-card">
    <div class="label">총 평가금</div>
    <div class="value">&#8361;{{ "{:,.0f}".format(journal.total_eval / 1000000) }}M</div>
  </div>
  <div class="summary-card">
    <div class="label">일일 손익</div>
    <div class="value {{ 'green' if journal.daily_pnl >= 0 else 'red' }}">{{ "{:+,.0f}".format(journal.daily_pnl) }}원</div>
  </div>
  <div class="summary-card">
    <div class="label">일일 수익률</div>
    <div class="value {{ 'green' if journal.daily_pnl_pct >= 0 else 'red' }}">{{ "{:+.2f}".format(journal.daily_pnl_pct) }}%</div>
  </div>
  <div class="summary-card">
    <div class="label">거래 건수</div>
    <div class="value">{{ journal.trade_count }}건</div>
  </div>
</div>

<!-- ═══ 스케줄러 실행 결과 ═══ -->
<div class="section-title">스케줄러 실행 이력</div>
<div class="journal-card">
  <table>
    <tr><th>시간</th><th>Phase</th><th>결과</th><th>비고</th></tr>
    {% for p in journal.phases %}
    <tr>
      <td>{{ p.time }}</td>
      <td>{{ p.name }}</td>
      <td><span class="phase-badge phase-{{ p.status }}">{{ p.status_label }}</span></td>
      <td style="text-align:left; font-size:0.75em;">{{ p.note }}</td>
    </tr>
    {% endfor %}
  </table>
</div>

<!-- ═══ 보유 포지션 현황 ═══ -->
<div class="section-title">보유 포지션 현황</div>
<div style="overflow-x: auto;">
<table>
  <tr>
    <th>종목</th>
    <th>수량</th>
    <th>진입가</th>
    <th>현재가</th>
    <th>수익률</th>
    <th>보유일</th>
    <th>등급</th>
  </tr>
  {% for pos in journal.positions %}
  <tr>
    <td style="text-align:left; font-weight:600;">{{ pos.name }} <small style="color:#6b7b8d;">{{ pos.ticker }}</small></td>
    <td>{{ pos.shares }}주</td>
    <td>&#8361;{{ "{:,.0f}".format(pos.entry_price) }}</td>
    <td>&#8361;{{ "{:,.0f}".format(pos.current_price) }}</td>
    <td class="{{ 'green' if pos.pnl_pct >= 0 else 'red' }}">{{ "{:+.2f}".format(pos.pnl_pct) }}%</td>
    <td>{{ pos.hold_days }}일</td>
    <td><span class="grade-badge grade-{{ pos.grade }}">{{ pos.grade }}</span></td>
  </tr>
  {% endfor %}
</table>
</div>

{% if journal.trades %}
<!-- ═══ 오늘 거래 내역 ═══ -->
<div class="section-title">오늘 거래 내역</div>
<div style="overflow-x: auto;">
<table>
  <tr><th>시간</th><th>종목</th><th>방향</th><th>수량</th><th>가격</th><th>사유</th></tr>
  {% for t in journal.trades %}
  <tr class="trade-row-{{ t.direction }}">
    <td>{{ t.time }}</td>
    <td style="text-align:left;">{{ t.name }}</td>
    <td class="{{ 'green' if t.direction == 'buy' else 'red' }}">{{ t.direction_label }}</td>
    <td>{{ t.shares }}주</td>
    <td>&#8361;{{ "{:,.0f}".format(t.price) }}</td>
    <td style="text-align:left; font-size:0.75em;">{{ t.reason }}</td>
  </tr>
  {% endfor %}
</table>
</div>
{% endif %}

{% if journal.signals %}
<!-- ═══ 내일 매수 후보 ═══ -->
<div class="section-title">내일 매수 후보</div>

{% for sig in journal.signals %}
<div class="signal-card">
  <div>
    <span class="signal-name">{{ sig.name }}</span>
    <span class="signal-code">{{ sig.ticker }}</span>
    <span class="grade-badge grade-{{ sig.grade }}" style="margin-left:6px;">{{ sig.grade }}</span>
  </div>
  <div class="signal-info">
    <span class="signal-tag">Zone <span class="blue">{{ "{:.3f}".format(sig.zone_score) }}</span></span>
    <span class="signal-tag">{{ sig.trigger }}</span>
    <span class="signal-tag">진입 &#8361;{{ "{:,.0f}".format(sig.entry_price) }}</span>
    <span class="signal-tag">손절 <span class="red">&#8361;{{ "{:,.0f}".format(sig.stop_loss) }}</span></span>
    <span class="signal-tag">R:R <span class="{{ 'green' if sig.rr_ratio >= 2.0 else 'yellow' }}">{{ "{:.1f}".format(sig.rr_ratio) }}</span></span>
  </div>
</div>
{% endfor %}
{% endif %}

<!-- ═══ 오늘의 교훈 ═══ -->
{% if journal.lessons %}
<div class="section-title">오늘의 교훈</div>
{% for lesson in journal.lessons %}
<div class="lesson-card">
  <strong>Lesson {{ loop.index }}:</strong> {{ lesson }}
</div>
{% endfor %}
{% endif %}

<p class="disclaimer">
  본 일지는 자비스 자동화 시스템에 의해 생성되었습니다.<br>
  {{ journal.date }} {{ journal.generated_time }} &middot; Powered by JARVIS Quant Framework v8.1
</p>

</body>
</html>
