# Design: 주식분석 서브에이전트

## 1. 엔티티 설계 (src/entities/models.py)

### 핵심 모델

```python
Stock           # 종목 기본 정보 (코드, 이름, 시장, 업종)
ChartData       # OHLCV + 기술적 지표 데이터
TechnicalPattern # 기술적 패턴 (캔들, 이평선 배열 등)
SupplyDemandZone # 매물대 (지지/저항 구간, 강도)
Condition       # 유지/대응 조건 (타입, 내용, 우선순위, 확신도)
FlowPrediction  # 흐름 예측 (방향, 확신도, 가격범위, 핵심요인)
AnalysisReport  # 최종 분석 리포트 (모든 분석 결과 종합)
```

### 의존성: 없음 (순수 데이터 객체, dataclass 사용)

## 2. 유스케이스 설계

### 2.1 Port 인터페이스 (src/use_cases/ports.py)

```python
ChartAnalysisPort      # analyze(stock, chart_data) → TechnicalPattern
VolumeAnalysisPort     # analyze(stock, chart_data) → list[SupplyDemandZone]
FlowPredictionPort     # predict(stock, patterns, zones) → FlowPrediction
ConditionJudgePort     # judge(stock, prediction, patterns) → list[Condition]
StockDataPort          # fetch(ticker, period) → tuple[Stock, ChartData]
ReportPresenterPort    # present(report) → str
```

### 2.2 Interactor (src/use_cases/stock_analysis.py)

```
StockAnalysisInteractor
  - 모든 Port를 주입받아 워크플로우 조율
  - execute(ticker, period) → AnalysisReport
```

## 3. 서브에이전트 역할 분담 (src/agents/)

| 에이전트 | 구현 Port | Claude 프롬프트 핵심 |
|---------|----------|-------------------|
| ChartAnalysisAgent | ChartAnalysisPort | 캔들 패턴, RSI, MACD, 볼린저, 이평선 분석 |
| VolumeAnalysisAgent | VolumeAnalysisPort | 거래량 추세, 매집/분산, 매물대 구간 |
| FlowPredictionAgent | FlowPredictionPort | 종합 데이터로 내일 방향/가격범위 예측 |
| ConditionJudgeAgent | ConditionJudgePort | 유지조건/대응조건/손익절 기준 생성 |

## 4. 데이터 흐름도

```
[사용자: 종목코드 입력]
       ↓
[StockDataAdapter] → Stock + ChartData
       ↓
[StockAnalysisInteractor] ─── 오케스트레이션 ───
       ├→ [ChartAnalysisAgent]  → TechnicalPattern
       ├→ [VolumeAnalysisAgent] → list[SupplyDemandZone]
       ↓ (위 결과를 종합)
       ├→ [FlowPredictionAgent] → FlowPrediction
       ├→ [ConditionJudgeAgent] → list[Condition]
       ↓
[AnalysisReport 생성]
       ↓
[MarkdownPresenter] → 마크다운 리포트 문자열
```

## 5. 구현 순서

1. `src/entities/models.py` → 모든 데이터 모델
2. `src/use_cases/ports.py` → Port 인터페이스 (ABC)
3. `src/use_cases/stock_analysis.py` → Interactor
4. `src/agents/chart_analysis.py` → 차트분석 에이전트
5. `src/agents/volume_analysis.py` → 거래량분석 에이전트
6. `src/agents/flow_prediction.py` → 흐름예측 에이전트
7. `src/agents/condition_judge.py` → 조건판단 에이전트
8. `src/adapters/stock_data_adapter.py` → 주식 데이터 어댑터
9. `src/adapters/markdown_presenter.py` → 리포트 프레젠터
10. `main.py` → 진입점
