# v10.3 ì½”ë“œ ê²€ìˆ˜ ì¼ì§€ (2026-02-18)

## ê²€ìˆ˜ ë²”ìœ„
- `src/signal_engine.py` (1,661 lines) â€” BES v3.1 Pipeline
- `src/v8_pipeline.py` (257 lines) â€” Gate+Score Hybrid
- `src/v8_triggers.py` (148 lines) â€” T1/T2/T3 íŠ¸ë¦¬ê±°
- `src/v8_gates.py` â€” Hard Gates
- `src/v8_scorers.py` â€” Scoring Engine
- `config/settings.yaml` â€” ì „ì²´ ì„¤ì •
- `scripts/backtest_v2.py` (~800 lines) â€” v10.1 ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„
- `scripts/backtest_group_rotation.py` (~500 lines) â€” 3ì¸µ ìˆœí™˜ë§¤ ë°±í…ŒìŠ¤íŠ¸
- `scripts/blind_test_daily.py` (~540 lines) â€” ë¸”ë¼ì¸ë“œ í…ŒìŠ¤íŠ¸ ìžë™í™”
- `scripts/combine_strategies.py` (~270 lines) â€” ì „ëžµ ê²°í•© ì‹œë®¬ë ˆì´ì…˜
- `src/html_report.py` (~300 lines) â€” HTML ë³´ê³ ì„œ

---

## 1. ë¡œì§ ê²€ìˆ˜

### [ðŸ”´ C0] v8_pipeline.py:194 â€” zone_score ratio_boost í›„ 1.0 ì´ˆê³¼ ê°€ëŠ¥ âœ… ìˆ˜ì •ì™„ë£Œ

**í˜„ìž¬ ì½”ë“œ (ìˆ˜ì • ì „):**
```python
result["zone_score"] = round(base_score + ratio_boost, 4)
```

**ë¬¸ì œ:** base_score(ìµœëŒ€ 1.0) + ratio_boost(ìµœëŒ€ 0.10) = ìµœëŒ€ 1.10.
zone_scoreëŠ” 0~1.0 ë²”ìœ„ë¡œ ì •ì˜ë˜ì–´ ìžˆìœ¼ë‚˜, ì´ ì½”ë“œì—ì„œ í´ëž¨í•‘ ì—†ì´ 1.0ì„ ì´ˆê³¼í•  ìˆ˜ ìžˆìŒ.
signal_engine.py:358ì—ì„œëŠ” `min(max(..., 0.0), 1.0)` íŒ¨í„´ìœ¼ë¡œ í´ëž¨í•‘í•˜ëŠ” ê²ƒê³¼ ë¶ˆì¼ì¹˜.

**ì˜í–¥:** í›„ì† ëª¨ë“ˆì—ì„œ zone_scoreë¥¼ 0~1 ë²”ìœ„ë¡œ ê°€ì •í•˜ë©´ ë¬¸ì œ ë°œìƒ. ëž­í‚¹/ì •ë ¬/ë³´ê³ ì„œ ì™œê³¡.

**ìˆ˜ì • ì™„ë£Œ:**
```python
result["zone_score"] = round(min(base_score + ratio_boost, 1.0), 4)
```

---

### [ðŸŸ¡ W7] settings.yaml:914-916 â€” T2 íŒŒë¼ë¯¸í„°ê°€ v8.5 ì—­ë„ì¶œê°’ìœ¼ë¡œ ë³€ê²½ë¨

**í˜„ìž¬ ê°’:**
- `vol_multiplier: 0.3` (v8.1 ì›ë³µê°’ 1.5ì—ì„œ ëŒ€í­ ì™„í™”)
- `rsi_range: [30, 80]` (v8.1 ì›ë³µê°’ [35,55]ì—ì„œ ëŒ€í­ í™•ëŒ€)

**ë¬¸ì œ:** v8.5 ì—­ë„ì¶œ(91ê±´)ë¡œ ë³€ê²½ í›„ v8.6 ê²Œì´íŠ¸ ì›ë³µ ì‹œ T2ë§Œ ë¯¸ì›ë³µ.
í˜„ìž¬ ê°’ì—ì„œëŠ” T2ê°€ ì‚¬ì‹¤ìƒ í•­ìƒ ë°œë™ (RSI 30~80ì´ë©´ ëŒ€ë¶€ë¶„ ì¢…ëª© í†µê³¼).
Gateê°€ ì¶©ë¶„ížˆ í•„í„°ë§í•˜ë¯€ë¡œ ìµœì¢… ê²°ê³¼ì— í° ì˜í–¥ì€ ì—†ìœ¼ë‚˜,
T2ì˜ "íƒ€ì´ë° í•„í„°" ì—­í• ì´ ë¬´ë ¥í™”ëœ ìƒíƒœ.

**ìƒíƒœ:** ë°±í…ŒìŠ¤íŠ¸ ì›ë³µ ê²°ê³¼(PF 1.50, +14.7%)ì—ì„œ ì´ ê°’ì´ í¬í•¨ëœ ìƒíƒœì´ë¯€ë¡œ
í˜„ìž¬ëŠ” ìœ ì§€. ê²Œì´íŠ¸ ë³€ê²½ ìž‘ì—… ì‹œ í•¨ê»˜ ê²€í†  í•„ìš”.

---

### [ðŸ”´ C1] backtest_v2.py:482 â€” pnl_pct ë°˜ë§¤ë„ í˜¼í•© ê³„ì‚° ë¶€ì •í™•

**í˜„ìž¬ ì½”ë“œ:**
```python
pnl_pct = (sell_price / pos.buy_price - 1) if not pos.half_sold else (
    (pos.half_sold_pnl + (sell_price / pos.buy_price - 1)) / 2
)
```

**ë¬¸ì œ:** ë°˜ë§¤ë„ ì‹œ half_sold_pnlì€ `(sell_price / buy_price - 1)` = ìˆœìˆ˜ ê°€ê²© ë³€ë™ë¥ .
í•˜ì§€ë§Œ ë‚˜ë¨¸ì§€ ë°˜ì€ ë‹¤ë¥¸ ê°€ê²©ì— ì²­ì‚°ë˜ë¯€ë¡œ ë‹¨ìˆœ í‰ê· ì´ ì•„ë‹Œ ì£¼ìˆ˜ ê°€ì¤‘ í•„ìš”.
half_sold í›„ sharesê°€ ì ˆë°˜ìœ¼ë¡œ ì¤„ì—ˆëŠ”ë°, ì›ëž˜ half_sharesì™€ ë‚¨ì€ sharesê°€ ë‹¤ë¥¼ ìˆ˜ ìžˆìŒ
(í™€ìˆ˜ ì£¼ì¼ ë•Œ `shares // 2`ë¡œ ì¸í•´ ë¶ˆê· ë“±).

**ì˜í–¥:** PF/ìŠ¹ë¥ ì— ì†Œí­ ì™œê³¡ (ëŒ€ë¶€ë¶„ ê±°ëž˜ì—ì„œëŠ” ë¯¸ë¯¸í•˜ë‚˜, ì›ì¹™ì ìœ¼ë¡œ ë¶€ì •í™•)

**ìˆ˜ì • ì œì•ˆ:**
```python
# half_sold_pnlì„ ê¸ˆì•¡ ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½
# ë˜ëŠ” half_shares/remaining_shares ë¹„ìœ¨ ê°€ì¤‘
```

**ìƒíƒœ:** v8.6ì—ì„œ ìˆ˜ìˆ˜ë£Œ ë°˜ì˜ì€ ìˆ˜ì •ë¨ (pnl_pct_net). ë°˜ë§¤ë„ ê°€ì¤‘ í˜¼í•©ì€ ë¯¸ìˆ˜ì •.

---

### [ðŸ”´ C2] backtest_v2.py:438 â€” ë°˜ë§¤ë„ day_pnl ì´ì¤‘ ê³„ì‚° ê°€ëŠ¥ì„±

**í˜„ìž¬ ì½”ë“œ:**
```python
# 1ì°¨ ìµì ˆ (ë°˜ë§¤ë„)
day_pnl += proceeds - half_shares * pos.buy_price
# ...
# ë‚˜ì¤‘ì— ì „ëŸ‰ ì²­ì‚° ì‹œ
pnl = proceeds - cost + (pos.half_sold_pnl * pos.allocated * 0.5 if pos.half_sold else 0)
day_pnl += pnl if mode != "A" else 0
```

**ë¬¸ì œ:** ë°˜ë§¤ë„ì˜ day_pnlê³¼ ì „ëŸ‰ ì²­ì‚°ì˜ day_pnlì´ ê°ê° ê³„ì‚°ë¨.
ë°˜ë§¤ë„ day_pnlì—ì„œ ì´ë¯¸ ì‹¤í˜„ëœ ìˆ˜ìµì´, ì „ëŸ‰ ì²­ì‚° ì‹œ `half_sold_pnl * allocated * 0.5`ë¡œ ë‹¤ì‹œ ê°€ì‚°.
ê°™ì€ ë‚  ë°˜ë§¤ë„+ì „ëŸ‰ì²­ì‚°ì´ ë™ì‹œì— ì¼ì–´ë‚˜ë©´ ì´ì¤‘ ê³„ì‚°.

**ì˜í–¥:** equity curveì˜ ì¼ì¼ PnL ì™œê³¡ â†’ MDD ê³„ì‚°ì— ê°„ì ‘ ì˜í–¥.
ì‹¤ì œë¡œëŠ” ê°™ì€ ë‚  ë™ì‹œ ë°œìƒì´ ë“œë¬¼ì–´ ì˜í–¥ ë¯¸ë¯¸.

**ìƒíƒœ:** ë¯¸ìˆ˜ì •

---

### [ðŸŸ¡ W1] signal_engine.py:920 â€” tc_cfg ì§ì ‘ ìˆ˜ì • (shared mutable state)

**í˜„ìž¬ ì½”ë“œ:**
```python
if news_score_boost >= 0.08:
    tc_cfg = self.triggers_cfg.get("trend_continuation", {})
    original_min = tc_cfg.get("min_conditions", 5)
    tc_cfg["min_conditions"] = max(original_min - 1, 3)
trend_cont = self.check_trend_continuation(df, idx)
if news_score_boost >= 0.08:
    tc_cfg["min_conditions"] = original_min
```

**ë¬¸ì œ:** `triggers_cfg`ì˜ `trend_continuation` ë”•ì…”ë„ˆë¦¬ë¥¼ ì§ì ‘ ìˆ˜ì • í›„ ì›ë³µ.
ë©€í‹°ìŠ¤ë ˆë”©ì´ë‚˜ ë™ì‹œ í˜¸ì¶œ ì‹œ race condition ê°€ëŠ¥.
í˜„ìž¬ ë‹¨ì¼ ìŠ¤ë ˆë“œë¼ ë¬¸ì œì—†ì§€ë§Œ, ì›ì¹™ì ìœ¼ë¡œ ìœ„í—˜.

**ì˜í–¥:** í˜„ìž¬ ë™ìž‘ì— ì˜í–¥ ì—†ìŒ. í–¥í›„ ë³‘ë ¬í™” ì‹œ ë²„ê·¸ ë°œìƒ ê°€ëŠ¥.

---

### [ðŸŸ¡ W2] v8_triggers.py:90 â€” T2 OR ì¡°ê±´ì´ ë„ˆë¬´ í—ˆìš©ì 

**í˜„ìž¬ ì½”ë“œ:**
```python
fired = vol_surge or rsi_in_range
```

**ë¬¸ì œ:** RSIê°€ 35~55 ë²”ìœ„ì´ê¸°ë§Œ í•˜ë©´ ê±°ëž˜ëŸ‰ ì¡°ê±´ ì—†ì´ë„ íŠ¸ë¦¬ê±° ë°œë™.
ëŒ€ë¶€ë¶„ì˜ ì¢…ëª©ì´ RSI 35~55 ë²”ìœ„ì— ìžˆì„ ìˆ˜ ìžˆì–´ íŠ¸ë¦¬ê±°ê°€ ê±°ì˜ í•­ìƒ ë°œë™.

**ì˜í–¥:** ë°±í…ŒìŠ¤íŠ¸ v8 ì›ë³µ ì„¤ì •ì—ì„œ ê²€ì¦ë¨ (PF 1.50). í˜„ íŒŒë¼ë¯¸í„°ì—ì„œëŠ” Gateê°€ ì¶©ë¶„ížˆ
í•„í„°ë§í•˜ë¯€ë¡œ ì‹¤ì§ˆ ë¬¸ì œëŠ” ì—†ìœ¼ë‚˜, êµ¬ì¡°ì ìœ¼ë¡œ T2ì˜ ë…ë¦½ í•„í„°ë§ ëŠ¥ë ¥ì´ ì•½í•¨.

**ìƒíƒœ:** ê¸°ì¡´ ì•Œë ¤ì§„ ì´ìŠˆ (v8.6 ê²€ìˆ˜ Warning). í˜„ìž¬ ìˆ˜ì¹˜ì—ì„œëŠ” í—ˆìš©.

---

### [ðŸŸ¡ W3] backtest_v2.py:390 â€” ë‚ ì§œ ì¸ë±ìŠ¤ pad ë°©ì‹ ê³µìœ  ë¬¸ì œ

**í˜„ìž¬ ì½”ë“œ:**
```python
loc = df.index.get_indexer([date], method="pad")
if loc[0] >= 0:
    ad = df.index[loc[0]]
    if abs((ad - date).days) <= 3:
        day_idx_map[ticker] = loc[0]
```

**ë¬¸ì œ:** ì¢…ëª©ë§ˆë‹¤ ê±°ëž˜ì¼ì´ ë‹¤ë¥¼ ìˆ˜ ìžˆìŒ (ìƒìž¥íì§€, ê±°ëž˜ì •ì§€ ë“±).
pad ë°©ì‹ìœ¼ë¡œ 3ì¼ê¹Œì§€ í—ˆìš©í•˜ë¯€ë¡œ, ì‹¤ì œë¡œëŠ” ê¸ˆìš”ì¼ ë°ì´í„°ë¥¼ ì›”ìš”ì¼ì— ì‚¬ìš© ê°€ëŠ¥.
ë¬¸ì œëŠ” ì´ ì¢…ëª©ì˜ ì‹œê·¸ë„ì´ "ë‹¹ì¼" ê¸°ì¤€ì´ ì•„ë‹Œ "ìµœëŒ€ 3ì¼ ì „" ê¸°ì¤€ì´ ë  ìˆ˜ ìžˆìŒ.

**ì˜í–¥:** 101ì¢…ëª© ì¤‘ ëŒ€ë¶€ë¶„ì€ ë™ì¼ ê±°ëž˜ì¼. ë¹„ì •ìƒ ì¢…ëª©ì—ì„œë§Œ ë°œìƒí•˜ë©° í™•ë¥  ë‚®ìŒ.

---

### [ðŸŸ¡ W4] backtest_v2.py:549-554 â€” ì‹œê·¸ë„ì¼ ë‹¤ìŒë‚  ì‹œê°€ ë§¤ìˆ˜ (ì˜¬ë°”ë¦„) but ìŠ¬ë¦¬í”¼ì§€ ë°©í–¥

**í˜„ìž¬ ì½”ë“œ:**
```python
next_open = float(df.iloc[idx + 1]["open"])
buy_price = next_open * (1 + SLIPPAGE)
```

**í™•ì¸:** ì‹œê·¸ë„ tì¼ â†’ t+1 ì‹œê°€ ë§¤ìˆ˜ â†’ look-ahead bias ì—†ìŒ. **ì •ìƒ**
ìŠ¬ë¦¬í”¼ì§€ 0.5% ìƒí–¥ ì ìš© â†’ **ì •ìƒ** (ë¶ˆë¦¬í•œ ë°©í–¥)

---

### [ðŸŸ¡ W5] backtest_group_rotation.py:420 â€” z_data ì—†ì„ ë•Œ stock_close ëŒ€ì²´

**í˜„ìž¬ ì½”ë“œ:**
```python
stock_close = z_data["close"] if z_data else pos.buy_price
```

**ë¬¸ì œ:** z_dataê°€ ì—†ì„ ë•Œ (ì¢…ëª© ë°ì´í„° gap) buy_priceë¥¼ ì‚¬ìš©.
ì´ë ‡ê²Œ í•˜ë©´ ì†ì ˆ/ìµì ˆ íŒì •ì´ ë§¤ìˆ˜ê°€ ê¸°ì¤€ì´ë¼ í•­ìƒ PnL=0.
ì¢…ëª©ì´ ì‹¤ì œë¡œëŠ” í¬ê²Œ ì›€ì§ì˜€ì„ ìˆ˜ ìžˆìŒ.

**ì˜í–¥:** ë°ì´í„° gap ë°œìƒ ì‹œ (ë§¤ìš° ë“œë¬¸ ê²½ìš°) ì˜¤íŒ ê°€ëŠ¥.

**ìˆ˜ì • ì œì•ˆ:** parquetì—ì„œ ì§ì ‘ í•´ë‹¹ ë‚ ì§œ closeë¥¼ ê°€ì ¸ì˜¤ëŠ” fallback ì¶”ê°€.

---

### [ðŸŸ¡ W6] blind_test_daily.py:81 â€” get_kospi_regime()ì´ "ì˜¤ëŠ˜" ë°ì´í„° ì‚¬ìš©

**í˜„ìž¬ ì½”ë“œ:**
```python
row = df.iloc[-1]  # ìµœì‹  ë°ì´í„°
```

**vs backtest_v2.py:**
```python
prev = kospi_df[kospi_df.index < date]  # ì „ì¼ ë°ì´í„°
```

**ë¬¸ì œ:** ë¸”ë¼ì¸ë“œ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ë‹¹ì¼ ìž¥ë§ˆê° í›„ ì‹¤í–‰í•˜ë¯€ë¡œ `df.iloc[-1]`ì´ "ì˜¤ëŠ˜".
ë°±í…ŒìŠ¤íŠ¸ì—ì„œëŠ” `< date`ë¡œ ì „ì¼ ë°ì´í„° ì‚¬ìš©.
ë¸”ë¼ì¸ë“œ í…ŒìŠ¤íŠ¸ê°€ ìž¥ë§ˆê° í›„ ì‹¤í–‰ë˜ë©´ ì´ëŠ” **ì˜ë„ëœ ë™ìž‘** (ë‹¹ì¼ ì¢…ê°€ ë°˜ì˜).
ë‹¨, ìž¥ì¤‘ì— ì‹¤í–‰í•˜ë©´ ì „ì¼ ì¢…ê°€ ê¸°ì¤€ì´ ë¨ â†’ ì¼ê´€ì„± ì´ìŠˆ.

**ì˜í–¥:** ì‚¬ìš© ì‹œì ì— ë”°ë¼ ë ˆì§ íŒì •ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìžˆìŒ. ìž¥ë§ˆê° í›„ ì‚¬ìš© ì‹œ ì •ìƒ.

---

## 2. ë°ì´í„° ë¬´ê²°ì„±

### [ðŸŸ¢ M1] signal_engine.py:231-245 â€” atr_pullback NaN ì²˜ë¦¬ ì–‘í˜¸

`pd.isna(pullback_atr) or pullback_atr < 0` â†’ 0.0 ë°˜í™˜. **ì •ìƒ**

### [ðŸŸ¢ M2] v8_triggers.py:48-51 â€” TRIX NaN ì‹œ ê¸°ë³¸ê°’ 0

`row.get('trix', 0)` â†’ NaNì´ ì•„ë‹Œ 0 ê¸°ë³¸ê°’. **ì •ìƒ**

### [ðŸŸ¢ M3] backtest_group_rotation.py:245-248 â€” std ë³´í˜¸

`if std_20 < 0.01: std_20 = 1.0` â†’ 0 ë‚˜ëˆ„ê¸° ë°©ì§€. **ì •ìƒ**

---

## 3. ê³„ì‚° ì •í™•ì„±

### [ðŸŸ¢ M4] backtest_v2.py:294-296 â€” ATR ê°„ì´ ê³„ì‚°

```python
atr_arr = df["high"].values - df["low"].values
atr = np.mean(atr_arr[max(0, idx - 13):idx + 1])
```

**í™•ì¸:** True Rangeê°€ ì•„ë‹Œ High-Lowë§Œ ì‚¬ìš©. ê°­ ê³ ë ¤ ì•ˆí•¨.
ê·¸ëŸ¬ë‚˜ v10.1 ì‹œê·¸ë„ì—ì„œëŠ” ê°„ì´ ATRì´ ì ì ˆ (TRIX ê¸°ë°˜ì´ë¼ ì •ë°€ ATR ë¶ˆí•„ìš”).
**í—ˆìš© ë²”ìœ„ ë‚´.**

### [ðŸŸ¢ M5] backtest_v2.py:622 â€” ë¯¸ì²­ì‚° í¬ì§€ì…˜ ê°•ì œ ì²­ì‚°ì˜ ìˆ˜ìˆ˜ë£Œ ë°˜ì˜

```python
pnl_pct = (last_close / pos.buy_price - 1) - COMMISSION * 2 - TAX
```
**ì •ìƒ.** ìˆ˜ìˆ˜ë£Œ+ì„¸ê¸ˆ ì°¨ê°ë¨.

### [ðŸŸ¢ M6] backtest_group_rotation.py:429 â€” ìˆœí™˜ë§¤ ìˆ˜ìˆ˜ë£Œ ë°˜ì˜

```python
pnl_pct = (sell_price / pos.buy_price - 1) - COMMISSION * 2 - TAX
```
**ì •ìƒ.**

### [ðŸŸ¢ M7] v8_pipeline.py:358 â€” Zone Score 0~1 ë²”ìœ„ ë³´ìž¥

zone_scoreëŠ” `ScoringEngine.score_all()`ì—ì„œ ê³„ì‚°.
signal_engine.py:358ì—ì„œ `min(max(..., 0.0), 1.0)` í´ë¦¬í•‘. **ì •ìƒ.**

---

## 4. ë°±í…ŒìŠ¤íŠ¸ ì—”ì§„ ê²€ìˆ˜

### [ðŸŸ¢ M8] Look-ahead bias ì ê²€

| í•­ëª© | ê²°ê³¼ |
|------|------|
| ë§¤ìˆ˜ íƒ€ì´ë° | tì¼ ì‹œê·¸ë„ â†’ t+1 ì‹œê°€ ë§¤ìˆ˜ âœ“ |
| ë§¤ë„ íƒ€ì´ë° | ìž¥ì¤‘ high/low ì²´í¬ â†’ ë‹¹ì¼ ë°˜ì˜ (í˜„ì‹¤ì ) âœ“ |
| KOSPI ë ˆì§ | `kospi_df.index < date` (ì „ì¼ ê¸°ì¤€) âœ“ |
| EWY í•„í„° | `get_etf_state()` pad ë°©ì‹ (ì „ì¼ ì´ì „) âœ“ |
| Z-score | ë‹¹ì¼ ë°ì´í„°ë¡œ ê³„ì‚° (ìž¥ì¤‘ íŒë‹¨) âœ“ |

### [ðŸŸ¢ M9] ì¤‘ë³µ ì§„ìž… ë°©ì§€

```python
if sig["ticker"] in held_tickers:
    continue
```
**ì •ìƒ.** v10.1 ë°±í…ŒìŠ¤íŠ¸ì™€ ìˆœí™˜ë§¤ ë°±í…ŒìŠ¤íŠ¸ ëª¨ë‘ ë³´ìœ  ì¢…ëª© ì§„ìž… ì°¨ë‹¨.

### [ðŸŸ¢ M10] í¬ì§€ì…˜ ì‚¬ì´ì§• ìƒí•œ

- v10.1: `MAX_POSITIONS = 5`, `MAX_DAILY_ENTRY = 2` âœ“
- ìˆœí™˜ë§¤: `MAX_POSITIONS = 3`, `MAX_PER_GROUP = 2` âœ“
- `available_slots = max_slots - len(positions)` â†’ ì´ˆê³¼ ë¶ˆê°€ âœ“

### [ðŸŸ¢ M11] MDD ê³„ì‚°

```python
eq_arr = np.array(equities)
peak = np.maximum.accumulate(eq_arr)
dd_pct = (eq_arr - peak) / peak * 100
mdd = np.min(dd_pct)
```
**ì •ìƒ.** ëˆ„ì  ìµœê³ ì  ëŒ€ë¹„ í•˜ë½ë¥  ë°©ì‹.

### [ðŸ”´ C3] backtest_v2.py:621 â€” ë¯¸ì²­ì‚° ê°•ì œ ì²­ì‚° ì‹œ iloc[-1] look-ahead bias âœ… ìˆ˜ì •ì™„ë£Œ

**í˜„ìž¬ ì½”ë“œ (ìˆ˜ì • ì „):**
```python
last_close = float(data_dict[pos.ticker].iloc[-1]["close"])
```

**ë¬¸ì œ:** parquet ë°ì´í„°ì˜ ë§ˆì§€ë§‰ í–‰ì´ END_DATE(2026-02-13) ì´í›„ì¼ ìˆ˜ ìžˆìŒ.
ì˜ˆ: ë°ì´í„°ê°€ 2026-02-17ê¹Œì§€ ìžˆìœ¼ë©´, ë¯¸ëž˜ ê°€ê²©ìœ¼ë¡œ ê°•ì œ ì²­ì‚° â†’ look-ahead bias.

**ìˆ˜ì • ì™„ë£Œ:** `day_idx_map`ì„ ì‚¬ìš©í•˜ì—¬ END_DATE ì‹œì  ê°€ê²© ì°¸ì¡°
```python
if pos.ticker in day_idx_map:
    last_close = float(data_dict[pos.ticker].iloc[day_idx_map[pos.ticker]]["close"])
```

---

### [ðŸŸ¡ W8] backtest_v2.py ë§¤ë„ ì „ì²´ â€” ë§¤ë„ ìŠ¬ë¦¬í”¼ì§€ ë¯¸ì ìš©

ë§¤ìˆ˜: `next_open * (1 + SLIPPAGE)` âœ“
ë§¤ë„: `sell_price` ê·¸ëŒ€ë¡œ ì‚¬ìš© âœ— (ì†ì ˆê°€/ëª©í‘œê°€/ì¢…ê°€ ëª¨ë‘)

vs ìˆœí™˜ë§¤: `sell_price * (1 - SLIPPAGE)` âœ“

**ì˜í–¥:** ìˆ˜ìµë¥ ì´ ì‹¤ì œë³´ë‹¤ ì•½ê°„ ê³¼ëŒ€ ì¶”ì • (ê±°ëž˜ë‹¹ ~0.5%).
í˜„ìž¬ C_new 125ê±´ ê¸°ì¤€ ì•½ 0.5~1%p ê³¼ëŒ€ ì¶”ì • ê°€ëŠ¥.

**ìƒíƒœ:** ìœ ì§€. ê²Œì´íŠ¸ ë³€ê²½ ìž‘ì—… ì‹œ ë§¤ë„ ìŠ¬ë¦¬í”¼ì§€ ì¼ê´„ ì¶”ê°€ ê²€í† .

---

### [ðŸŸ¡ W9] backtest_group_rotation.py:521 â€” ë‹¹ì¼ ì¢…ê°€ ë§¤ìˆ˜

v10.1: `next_open * (1 + SLIPPAGE)` (ë‹¤ìŒë‚  ì‹œê°€)
ìˆœí™˜ë§¤: `data["close"] * (1 + SLIPPAGE)` (ë‹¹ì¼ ì¢…ê°€)

z-score ê¸°ë°˜ì´ë¼ ìž¥ì¤‘ ê³„ì‚° ê°€ëŠ¥í•˜ë‚˜, ì—„ë°€ížˆëŠ” ë‹¤ìŒë‚  ì‹œê°€ê°€ í˜„ì‹¤ì .
ìŠ¬ë¦¬í”¼ì§€ 0.5%ë¡œ ë¶€ë¶„ ë³´ì •.

**ìƒíƒœ:** ìœ ì§€. ìˆœí™˜ë§¤ ì „ìš© ì´ìŠˆ. ì‹¤ì „ ë¸”ë¼ì¸ë“œ í…ŒìŠ¤íŠ¸ì—ì„œëŠ” ë‹¤ìŒë‚  ì‹œê°€ ì‚¬ìš© ì˜ˆì •.

---

### [ðŸŸ¡ W10] ì–‘ìª½ ë°±í…ŒìŠ¤íŠ¸ â€” ê°•ì œ ì²­ì‚° ìŠ¬ë¦¬í”¼ì§€ ëˆ„ë½ âœ… ìˆœí™˜ë§¤ë§Œ ìˆ˜ì •

- ìˆœí™˜ë§¤: `sell_price * (1 - SLIPPAGE)` ì¶”ê°€ âœ…
- v10.1: ë¯¸ìˆ˜ì • (W8ê³¼ ì¼ê´„ ì²˜ë¦¬ ì˜ˆì •)

---

## 5. ì¶œë ¥ ê²°ê³¼ ê²€ì¦

### [ðŸŸ¢ M12] HTML ë³´ê³ ì„œ â€” v9 ê°ì§€ ë¡œì§

```python
is_v9 = candidates and "v9_rank_score" in candidates[0]
```
v9 í‚¤ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ v8 HTML ì‚¬ìš©. **ì •ìƒ.**

### [ðŸŸ¡ W11] ë¸”ë¼ì¸ë“œ í…ŒìŠ¤íŠ¸ z-score std fallback â†” ë°±í…ŒìŠ¤íŠ¸ ë¶ˆì¼ì¹˜

blind_test_daily.pyì˜ `scan_rotation()`ê³¼ backtest_group_rotation.pyì˜
`calc_group_z_scores()`ë¥¼ ë¹„êµ:
- ë™ì¼ ê³µì‹: `z_20 = (rel_ret_20 - mean_20) / std_20` âœ“
- **std ë³´í˜¸ ë¶ˆì¼ì¹˜:**
  - blind_test_daily.py:258: `max(np.std(rel_20_vals), 0.01)` â†’ fallback **0.01**
  - backtest_group_rotation.py:245: `if std_20 < 0.01: std_20 = 1.0` â†’ fallback **1.0**
- ë™ì¼ ì§„ìž… ì¡°ê±´: z_20 < -0.8, rel_ret_20 < -3%, ë°˜ì „ í™•ì¸, MA60 ìœ„ âœ“

**ë¶ˆì¼ì¹˜.** std < 0.01 ìƒí™©ì—ì„œ z-scoreê°€ 100ë°° ì°¨ì´.
ì˜ˆ: rel_ret=0.05ì¼ ë•Œ blind_test z=5.0 vs backtest z=0.05.
ì‹¤ì œë¡œ 10ì¢…ëª© ì´ìƒ ê·¸ë£¹ì—ì„œ std < 0.01ì€ ë“œë¬¼ì§€ë§Œ, ë°œìƒ ì‹œ ê²°ê³¼ ë¶ˆì¼ì¹˜.

**ìˆ˜ì • ì™„ë£Œ:** backtest_group_rotation.pyë¥¼ blind_testì™€ ë™ì¼í•˜ê²Œ `max(std, 0.01)` ë°©ì‹ìœ¼ë¡œ í†µì¼. âœ…

---

## ìš”ì•½

| ì‹¬ê°ë„ | ê±´ìˆ˜ | í•­ëª© |
|--------|------|------|
| ðŸ”´ Critical | 4 | C0 (zone_score âœ…), C1 (ë°˜ë§¤ë„ PnL), C2 (ë°˜ë§¤ë„ ì´ì¤‘ê³„ì‚°), C3 (iloc[-1] âœ…) |
| ðŸŸ¡ Warning | 11 | W1~W11 |
| ðŸŸ¢ Minor | 12 | M1~M12 |

### Critical í‰ê°€
- **C0: zone_score í´ëž¨í•‘ ëˆ„ë½ â†’ âœ… ì¦‰ì‹œ ìˆ˜ì • ì™„ë£Œ** (`min(..., 1.0)` ì¶”ê°€)
- **C3: iloc[-1] look-ahead bias â†’ âœ… ì¦‰ì‹œ ìˆ˜ì • ì™„ë£Œ** (`day_idx_map` ì‚¬ìš©)
- **C1, C2 ëª¨ë‘ Dëª¨ë“œ(ë°˜ë§¤ë„ ìµì ˆ) ì „ìš©.** C_new ëª¨ë“œì—ì„œëŠ” ë°˜ë§¤ë„ ì—†ìœ¼ë¯€ë¡œ ì˜í–¥ ì—†ìŒ.
- í˜„ìž¬ ìš´ìš© ëª¨ë“œëŠ” **C_new** (KOSPI ë ˆì§ ìº¡) â†’ **C1/C2 ì˜í–¥ ì—†ìŒ**.
- Dëª¨ë“œë¥¼ ì‚¬ìš©í•  ê²½ìš°ì—ë§Œ ìˆ˜ì • í•„ìš”.

### ì´ì „ ê²€ìˆ˜ ëŒ€ë¹„ ë³€ê²½
- v8.6 C1 (pnl_pct ìˆ˜ìˆ˜ë£Œ): âœ… ìˆ˜ì • ì™„ë£Œ í™•ì¸
- v8.6 GPT/OpenAI ì œê±°: âœ… í™•ì¸
- ì‹ ê·œ íŒŒì¼ (blind_test_daily.py, combine_strategies.py, backtest_group_rotation.py):
  **ì‹ ê·œ ê²€ìˆ˜ ì™„ë£Œ. Critical ì´ìŠˆ ì—†ìŒ.**

### ê²°ë¡ 
**C0, C3 ìˆ˜ì • ì™„ë£Œ. W11 (z-score std fallback) ìˆ˜ì • ì™„ë£Œ.**
**í˜„ìž¬ ìš´ìš© ì½”ë“œ(C_new + ìˆœí™˜ë§¤ Dëª¨ë“œ)ì— ìž”ì—¬ Critical ì—†ìŒ.**
Dëª¨ë“œ ë°˜ë§¤ë„ ë¡œì§(C1/C2) ê°œì„ ì€ í–¥í›„ ê³¼ì œë¡œ ë‚¨ê¹€.
T2 íŒŒë¼ë¯¸í„°(W7), ë§¤ë„ ìŠ¬ë¦¬í”¼ì§€(W8)ëŠ” ê²Œì´íŠ¸ ë³€ê²½ ìž‘ì—… ì‹œ í•¨ê»˜ ê²€í†  ì˜ˆì •.
